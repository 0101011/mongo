#! /bin/sh
#
# Copyright (c) 2008-2011 WiredTiger, Inc.
#	All rights reserved.

# Build Makefile.am
. ../dist/RELEASE

filelist=../dist/filelist
set_sources()
{
	echo
	echo "libwiredtiger_la_LDFLAGS = -release ${WIREDTIGER_VERSION_MAJOR}.${WIREDTIGER_VERSION_MINOR}"
	echo "libwiredtiger_la_SOURCES=\\"
	sed -e '/^[a-z]/! d' \
	    -e 's/.*/	..\/& \\/' \
	    -e '$s/ \\$//' < $filelist
}

set_vpath()
{
	echo
	printf "VPATH = ../examples/c:"
	sed -e '/^[a-z]/! d' \
	    -e 's/\(.*\)\/.*/\1/' < $filelist |
	sort -u |
	while read d ; do printf "../%s:" $d ; done
	echo "../src/utilities"
}

(
  sed -e "s/@WIREDTIGER_VERSION_MAJOR@/$WIREDTIGER_VERSION_MAJOR/" \
      -e "s/@WIREDTIGER_VERSION_MINOR@/$WIREDTIGER_VERSION_MINOR/" \
      -e "s/@WIREDTIGER_VERSION_PATCH@/$WIREDTIGER_VERSION_PATCH/" \
      Make.base; set_vpath; set_sources) > Makefile.am
