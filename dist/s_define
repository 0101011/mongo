#! /bin/sh
#
# $Id$

# Complain about unused #defines.
t=__wt.$$
trap 'rm -f $t; exit 0' 0 1 2 3 13 15

# List of files to search.
l="../*/*.c ../utilities/*/*.c"

(
# Copy out the list of #defines we don't use, but it's OK.
sed -e '/^$/d' -e '/^#/d' < s_define.list

for i in \
    `cat ../inc_posix/*.h ../inc_posix/*.in |
     egrep '^#define' |
     sed 's/#define[	 ][	 ]*\([A-Za-z_]*\).*/\1/' |
     sort -u`; do
	if `egrep -w "$i" $l > /dev/null`; then
		continue
	fi
	echo $i
done

# The stat #defines are a bit harder for two reasons: first, we don't care
# about "usage" in support/stat.c because it's auto-generated, we care if
# the #define is set somewhere else; second, we don't use the "WT_STAT_"
# prefix when we call a stat macro, the stat macro handles that for us.
l=`echo $l | sed -e 's/\.\.\/support\/stat.c//'`

for i in \
    `cat ../inc_posix/stat.h |
     egrep '^#define' |
     sed -e 's/#define[	 ][	 ]*\([A-Za-z_]*\).*/\1/' \
         -e 's/WT_STAT_//' |
     sort -u`; do
	if `egrep -w "$i" $l > /dev/null`; then
		continue
	fi
	echo "WT_STAT_$i"
done

) | sort | uniq -u > $t

test -s $t && {
	echo 'Unused #defines:'
	sed 's/^/	/' < $t
}

exit 0
