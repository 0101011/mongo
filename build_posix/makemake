#! /bin/sh
#
# Copyright (c) 2008-2011 WiredTiger, Inc.
#	All rights reserved.

# Build Makefile.am

# Process Make.base, removing any subdirs that don't exist.
# This is used in release trees, which exclude some parts of
# the development tree.
(sed -n '1,/^SUBDIRS/p' Make.base

sed '1,/^SUBDIRS/d' Make.base | sed -e '/^$/,$d' -e 's/ \\$//' | \
    while read d ; do
	case "$d" in
	[a-z]*) [ -d ../$d ] || continue ;;
	esac
	echo "	$d \\"
    done | sed '$s/ \\$//'

# Terminate the list with a blank line
echo

# Write the rest of Make.base
sed '1,/^SUBDIRS/d' Make.base | sed '1,/^$/d'

echo
echo "libwiredtiger_la_LDFLAGS = -release @VERSION@"
echo "libwiredtiger_la_SOURCES=\\"
sed -e '/^[a-z]/! d' \
    -e 's/.*/	& \\/' \
    -e '$s/ \\$//' < ../dist/filelist
) > ../Makefile.am
