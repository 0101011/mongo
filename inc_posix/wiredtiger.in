/*-
 * See the file LICENSE for redistribution information.
 *
 * Copyright (c) 2008 WiredTiger Software.  All rights reserved.
 *
 * $Id$
 */

#ifndef	__WIREDTIGER_H_
#define	__WIREDTIGER_H_

#if defined(__cplusplus)
extern "C" {
#endif

/*******************************************
 * Version information
 *******************************************/
#define	WIREDTIGER_VERSION_MAJOR	@WIREDTIGER_VERSION_MAJOR@
#define	WIREDTIGER_VERSION_MINOR	@WIREDTIGER_VERSION_MINOR@
#define	WIREDTIGER_VERSION_PATCH	@WIREDTIGER_VERSION_PATCH@
#define	WIREDTIGER_VERSION_STRING	@WIREDTIGER_VERSION_STRING@

/*******************************************
 * Required includes
 *******************************************/
@wiredtiger_includes_decl@

/*******************************************
 * Portable type names
 *******************************************/
@int8_decl@
@u_int8_decl@
@int16_decl@
@u_int16_decl@
@int32_decl@
@u_int32_decl@
@int64_decl@
@u_int64_decl@
@uintmax_t_decl@
@uintptr_t_decl@

/*******************************************
 * Forward declarations
 *******************************************/
struct __db;	typedef struct __db DB;
struct __dbc;	typedef struct __dbc DBC;
struct __dbt;	typedef struct __dbt DBT;
struct __env;	typedef struct __env ENV;
struct __idb;	typedef struct __idb IDB;
struct __idbc;	typedef struct __idbc IDBC;
struct __ienv;	typedef struct __ienv IENV;

/*******************************************
 * Errors
 *******************************************/
/*
 * User-visible error return codes.
 *  0 == success
 * >0 == hard error
 * <0 == unexpected outcome
 *
 * !!!
 * We don't want our error returns to conflict with any other package, so
 * try and use an uncommon range, specifically, -31,800 to -31,999.
 */
#define	WT_ERROR	(-31800)

/*******************************************
 * Exported types
 *******************************************/
typedef u_int64_t wt_recno_t;		/* logical record numbers */

/*******************************************
 * Key/data structure -- a Data-Base Thang
 *******************************************/
struct __dbt {
	void	*data;			/* data */
	size_t	 size;			/* data length */
};

/*******************************************
 * Database handle
 *******************************************/
struct __db {
	IDB *idb;			/* Private object */

	ENV *env;			/* Enclosing environment */
	IENV *ienv;			/* Private environment object */

					/* Error callback */
	void (*errcall)(const DB *, const char *);
	FILE		*errfile;	/* Error message file stream */
	const char	*errpfx;	/* Error message prefix */

	u_int32_t	pagesize;	/* Page size */
	u_int32_t	extentsize;	/* Extent size */

	u_int32_t	maxitemsize;	/* Maximum key size */

	/* Getters/setters */
	int  (*set_errcall)(DB *, void (*)(const DB *, const char *));
	void (*get_errcall)(DB *, void (**)(const DB *, const char *));
	int  (*set_errfile)(DB *, FILE *);
	void (*get_errfile)(DB *, FILE **);
	int  (*set_errpfx)(DB *, const char *);
	void (*get_errpfx)(DB *, const char **);
	int  (*set_maxitemsize)(DB *, u_int32_t);
	void (*get_maxitemsize)(DB *, u_int32_t *);
	void (*get_pagesize)(DB *, u_int32_t *, u_int32_t *);
	int  (*set_pagesize)(DB *, u_int32_t, u_int32_t);

	/* Methods */
	int  (*bulk_load)(DB *, int (*)(DB *, DBT **, DBT **));
	int  (*destroy)(DB *, u_int32_t);
	int  (*dump)(DB *, FILE *, u_int32_t);
	void (*err)(DB *, int, const char *, ...);
	void (*errx)(DB *, const char *, ...);
	int  (*open)(DB *, const char *, mode_t, u_int32_t);

	u_int32_t flags;
};

/*******************************************
 * Cursor handle
 *******************************************/
struct __dbc {
	IDBC *idbc;			/* Private object */

	u_int32_t flags;
};

/*******************************************
 * Database environment handle
 *******************************************/
struct __env {
	IENV *ienv;			/* Private object */

					/* Error callback */
	void (*errcall)(const ENV *, const char *);
	FILE		*errfile;	/* Error message file stream */
	const char	*errpfx;	/* Error message prefix */

	u_int32_t	 verbose;	/* Verbose flags */

	/* Getters/setters */
	int  (*set_errcall)(ENV *, void (*)(const ENV *, const char *));
	void (*get_errcall)(ENV *, void (**)(const ENV *, const char *));
	int  (*set_errfile)(ENV *, FILE *);
	void (*get_errfile)(ENV *, FILE **);
	int  (*set_errpfx)(ENV *, const char *);
	void (*get_errpfx)(ENV *, const char **);
	int  (*set_verbose)(ENV *, u_int32_t);
	void (*get_verbose)(ENV *, u_int32_t *);

	/* Methods */
	int  (*destroy)(ENV *, u_int32_t);
	void (*err)(ENV *, int, const char *, ...);
	void (*errx)(ENV *, const char *, ...);

	u_int32_t flags;
};

/*******************************************
 * Prototypes.
 *******************************************/
int	 wt_db_create(DB **, ENV *, u_int32_t);
int	 wt_env_create(ENV **, u_int32_t);
char	*wt_strerror(int);

#if defined(__cplusplus)
}
#endif
#endif /* __WIREDTIGER_H_ */
