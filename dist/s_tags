#! /bin/sh
#
# $Id$

# Build tags file.
f=tags
echo "Building $f..."
rm -f $f

# Test to see what flags this ctags binary supports.
# Use the -d, -t and -w flags to ctags if available.
t=/tmp/__a.c
trap 'rm -f $t; exit 0' 0 1 2 3 13 15
echo "f() { int a; }" > $t

flags=""
for i in -d -t -w; do
	if ctags $i $t 2>/dev/null; then
		flags="$i $flags"
	fi
done

ctags $flags ../*/*.in ../*/*.[ch] 2>/dev/null
chmod 444 $f

# Link to the tags file from all source directories.
dirs="../build_posix `echo ../*/*.c | sed 's/\(.*\)\/.*/\1/' | sort -u`"
for i in $dirs; do
	(cd $i && rm -f tags && ln -s ../dist/tags .)
done
